<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArbiShark - Live Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-active {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid #22c55e;
        }

        .status-safe-mode {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            font-size: 0.875rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .card-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .card-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .positive {
            color: #22c55e;
        }

        .negative {
            color: #ef4444;
        }

        .chart-container {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            margin-bottom: 30px;
        }

        .trade-history {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .trade-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .trade-row:last-child {
            border-bottom: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(148, 163, 184, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
            transition: width 0.3s ease;
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü¶à ArbiShark</h1>
            <span class="status-badge status-active pulse" id="status-badge">‚óè ACTIVE</span>
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-title">Total PnL</div>
                <div class="card-value positive" id="total-pnl">$0.00</div>
                <div class="card-change positive" id="pnl-change">
                    ‚Üë $0.00 today
                </div>
            </div>

            <div class="card">
                <div class="card-title">Trades Today</div>
                <div class="card-value" id="trades-today">0</div>
                <div class="card-change">
                    Win Rate: <span id="win-rate">0%</span>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Daily Allowance</div>
                <div class="card-value" id="daily-spent">$0.00</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="allowance-progress" style="width: 0%"></div>
                </div>
                <div class="card-change" style="margin-top: 8px;">
                    <span id="remaining-allowance">$10.00</span> remaining
                </div>
            </div>

            <div class="card">
                <div class="card-title">Strategy Mode</div>
                <div class="card-value" id="strategy-mode" style="font-size: 1.5rem;">Normal</div>
                <div class="card-change">
                    Envio Latency: <span id="envio-latency">0ms</span>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Gas Savings</div>
                <div class="card-value positive" id="gas-saved">$0.00</div>
                <div class="card-change">
                    vs Ethereum L1
                </div>
            </div>

            <div class="card">
                <div class="card-title">Uptime</div>
                <div class="card-value" id="uptime">0h 0m</div>
                <div class="card-change">
                    Version: <span id="version">1.0.0</span>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <h3 style="margin-bottom: 20px;">Performance Chart</h3>
            <canvas id="performance-chart" width="800" height="300"></canvas>
        </div>

        <div class="trade-history">
            <h3 style="margin-bottom: 20px;">Recent Trades</h3>
            <div id="trade-list">
                <div class="trade-row" style="color: #64748b;">
                    <span>No trades yet...</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WebSocket connection
        const ws = new WebSocket('ws://localhost:3000/ws');

        ws.onopen = () => {
            console.log('‚úÖ Connected to ArbiShark');
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            updateDashboard(data);
        };

        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
            document.getElementById('status-badge').textContent = '‚óè DISCONNECTED';
            document.getElementById('status-badge').className = 'status-badge status-safe-mode';
        };

        function updateDashboard(metrics) {
            // Update PnL
            const pnlElement = document.getElementById('total-pnl');
            pnlElement.textContent = `$${metrics.total_pnl.toFixed(2)}`;
            pnlElement.className = `card-value ${metrics.total_pnl >= 0 ? 'positive' : 'negative'}`;

            document.getElementById('pnl-change').innerHTML = `
                ${metrics.daily_pnl >= 0 ? '‚Üë' : '‚Üì'} $${Math.abs(metrics.daily_pnl).toFixed(2)} today
            `;

            // Update trades
            document.getElementById('trades-today').textContent = metrics.trades_today;
            document.getElementById('win-rate').textContent = `${(metrics.win_rate * 100).toFixed(1)}%`;

            // Update allowance
            document.getElementById('daily-spent').textContent = `$${metrics.daily_spent.toFixed(2)}`;
            document.getElementById('remaining-allowance').textContent = `$${metrics.remaining_allowance.toFixed(2)}`;
            
            const allowancePercent = (metrics.daily_spent / metrics.daily_limit) * 100;
            document.getElementById('allowance-progress').style.width = `${Math.min(allowancePercent, 100)}%`;

            // Update strategy mode
            document.getElementById('strategy-mode').textContent = metrics.strategy_mode;
            document.getElementById('envio-latency').textContent = `${metrics.envio_latency_ms}ms`;

            // Update gas savings
            document.getElementById('gas-saved').textContent = `$${metrics.gas_saved_vs_l1.toFixed(2)}`;

            // Update uptime
            const hours = Math.floor(metrics.uptime_seconds / 3600);
            const minutes = Math.floor((metrics.uptime_seconds % 3600) / 60);
            document.getElementById('uptime').textContent = `${hours}h ${minutes}m`;
            document.getElementById('version').textContent = metrics.version;

            // Update status
            const statusBadge = document.getElementById('status-badge');
            if (metrics.is_safe_mode) {
                statusBadge.textContent = '‚óè SAFE MODE';
                statusBadge.className = 'status-badge status-safe-mode pulse';
            } else {
                statusBadge.textContent = '‚óè ACTIVE';
                statusBadge.className = 'status-badge status-active pulse';
            }
        }

        function addTrade(trade) {
            const tradeList = document.getElementById('trade-list');
            const tradeRow = document.createElement('div');
            tradeRow.className = 'trade-row';
            
            const time = new Date(trade.timestamp).toLocaleTimeString();
            const pnlClass = trade.pnl >= 0 ? 'positive' : 'negative';
            
            tradeRow.innerHTML = `
                <span>${time}</span>
                <span>${trade.market_id}</span>
                <span class="${pnlClass}">${trade.pnl >= 0 ? '+' : ''}$${trade.pnl.toFixed(2)}</span>
            `;
            
            tradeList.insertBefore(tradeRow, tradeList.firstChild);
            
            // Keep only last 10 trades
            while (tradeList.children.length > 10) {
                tradeList.removeChild(tradeList.lastChild);
            }
        }

        // Fetch initial data
        fetch('http://localhost:3000/api/metrics')
            .then(res => res.json())
            .then(data => updateDashboard(data))
            .catch(err => console.error('Failed to fetch initial data:', err));
    </script>
</body>
</html>